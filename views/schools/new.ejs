<% layout('layouts/boilerplate') %>

<style>
    #map {
        height: 250px;
    }

    #geocoder {
        position: relative;
        width: 100%;
    }

    .mapboxgl-ctrl-geocoder {
        width: 100%;
        max-width: 100%;
    }

    #geocoder-city .mapboxgl-ctrl-geocoder:first-child {
        z-index: 1001;
    }

    /* #geocoder-address .mapboxgl-ctrl-geocoder:first-child {
        z-index: 1001;
    } */


</style>

<link href="/css/form.css" rel="stylesheet">

<script src='https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.js'></script>
<link href='https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css' rel='stylesheet' />

<div class="pb-4">
    <div class="col-md-6 col-sm-12 m-auto mt-4 form-container">
        <%- include('../partials/flash') %>
        <!-- Load the `mapbox-gl-geocoder` plugin. -->
        <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
        <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css" type="text/css">


        
        <!-- Head of the form -->
        <div>
            <h1 class="text-center pb-2 pt-2">Add New Preschool</h1>
            <div class="form-header">
                <div>
                    <button class="btn btn-primary btn-sm back-button hidden">Back</button>
                </div>
                <div class="step-container">
                    <div id="step-1" class="step active"><div class="step__circle">1</div><div class="step__text">General Info</div></div>
                    <div id="step-2" class="step"><div class="step__circle">2</div><div class="step__text">Pricing & Amenities</div></div>

                </div>
            </div>
        </div>
        <hr>

        <!-- FORM DATA -->
        <form action="/school" method="POST" enctype="multipart/form-data" novalidate>
            
            <!-- Card 1 - Start -->
            <div data-card="1" class="">
                <div class="row mb-3">
                    <label class="form-label">Preschool Type</label>
                    <div>
                        <% for (const category of categories) { %> 
                            <input type="checkbox" class="btn-check" name="school[category]" value="<%= category.short %>" id="<%= category.name %>" autocomplete="off">
                            <label class="btn btn-outline-secondary mb-1" for="<%= category.name %>"><%= category.name %></label> 
                        <% } %>
                    </div>
                    <div id="cat-invalid-feedback" class="invalid-feedback">
                        You need to select at least one category!
                    </div>
                    <div id="cat-valid-feedback" class="valid-feedback">
                        Looks good!
                    </div>
                </div>

                <div class="row mb-3">
                    <div>
                        <label for="name" class="form-label">Preschool name</label>
                        <input name="school[title]" type="text" class="form-control" id="name" placeholder="Preschool name">
                        <div class="valid-feedback">
                            Looks good!
                        </div>
                        <div class="invalid-feedback">
                            Type the preschool name!
                        </div>
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col">
                        <label for="country" class="form-label">Country</label>
                        <select name="school[country][code]" id="country" class="form-select" required>
                            <option selected="true" disabled="disabled" value="">Select your country</option>
                            <optgroup label="North America">
                                <option value="US">United States</option>
                                <option value="CA">Canada</option>
                            </optgroup>
                            
                            <optgroup label="Europe">
                                <option value="GB">United Kingdom</option>  
                                <option value="AT">Austria</option>
                                <option value="BE">Belgium</option>
                                <option value="CZ">Czech Republic</option>
                                <option value="FR">France</option>
                                <option value="DE">Germany</option>
                                <option value="GR">Greece</option>
                                <option value="HU">Hungary</option>
                                <option value="IT">Italy</option>
                                <option value="LI">Liechtenstein</option>
                                <option value="LU">Luxembourg</option>          
                                <option value="MC">Monaco</option>
                                <option value="NL">Netherlands</option>
                                <option value="PL">Poland</option>
                                <option value="PT">Portugal</option>        
                                <option value="SK">Slovakia</option>
                                <option value="SI">Slovenia</option>
                                <option value="ES">Spain</option>
                                <option value="UA">Ukraine</option>
                                <option value="DK">Denmark</option>
                                <option value="EE">Estonia</option>
                                <option value="FI">Finland</option>
                                <option value="IS">Iceland</option>
                                <option value="IE">Ireland</option>
                                <option value="NO">Norway</option>
                                <option value="SE">Sweden</option>
                                <option value="CH">Switzerland</option>
                            </optgroup>
                            
                            <optgroup label="Asia">
                                <!-- <option value="HK">Hong Kong</option> -->
                                <!-- <option value="ID">Indonesia</option> -->
                                <!-- <option value="JP">Japan</option> -->
                                <!-- <option value="KR">Korea, Republic of</option> -->
                                <option value="MY">Malaysia</option>
                                <option value="SG">Singapore</option>
                                <!-- <option value="TW">Taiwan</option> -->
                            </optgroup>
                            
                            <optgroup label="Australia / Oceania">
                                <option value="AU">Australia</option>
                                <option value="NZ">New Zealand</option>
                            </optgroup>
                        </select>  
                    </div>

                    <div class="col">
                        <label for="geocoder-city" class="form-label">City</label>
                        <div id="geocoder-city"></div>  
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col">
                        <label for="geocoder-address" class="form-label">Address</label>
                        <div id="geocoder-address"></div>  
                    </div>
                </div>

                <!-- HIDDEN FIELDS -->
                <input type="hidden" id="_coordinates" name="school[geometry][coordinates]">
                <input type="hidden" id="_lat" name="school[lat]">
                <input type="hidden" id="_long" name="school[long]">
                <input type="hidden" id="_fullAddress" name="school[context][fullAddress]">
                <input type="hidden" id="_streetName" name="school[context][streetName]">
                <input type="hidden" id="_streetNumber" name="school[context][streetNumber]">
                <input type="hidden" id="_zip" name="school[context][zip]">
                <input type="hidden" id="_city" name="school[city][name]" >
                <input type="hidden" id="_cityCenterCoords" name="school[city][coordinates]">
                <input type="hidden" id="_bbox" name="school[city][bbox]">
                <input type="hidden" id="_countryName" name="school[country][name]">
                <input type="hidden" id="_region" name="school[context][region]">
                <input type="hidden" id="_neighborhood" name="school[context][neighborhood]">
                <input type="hidden" id="_locality" name="school[context][locality]">
                <input type="hidden" id="_district" name="school[context][district]"> 
                <input type="hidden" id="_continent" name="school[context][continent][name]"> 
                
                <div id="map" class="mb-3"></div>
                <!-- <pre id="result"></pre> -->

                <div class="pt-2">
                    <h5>Specifics</h5>
                    <div class="row mb-3">
                        <div class="col">
                            <label for="email" class="form-label">Email address</label>
                            <input name="school[contact][email]" type="text" class="form-control" id="email" placeholder="Email address" required>  
                        </div>
                        <div class="col">
                            <label for="phone" class="form-label">Phone Number</label>
                            <input name="school[contact][phone]" type="text" class="form-control" id="phone" placeholder="Eg.+12012987481">  
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <label for="fb" class="form-label">Facebook</label>
                            <input name="school[contact][fb]" type="text" class="form-control" id="fb" placeholder="Facebook Page">  
                        </div>
                        <div class="col">
                            <label for="ig" class="form-label">Instagram</label>
                            <input name="school[contact][ig]" type="text" class="form-control" id="ig" placeholder="Instagram Page">  
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col">
                            <label for="www" class="form-label">Website</label>
                            <input name="school[contact][www]" type="text" class="form-control" id="www" placeholder="Eg. https://hogwarts.com">  
                        </div>
                        <div class="col">
                            <label for="manager" class="form-label">Owner/Manager Name</label>
                            <input name="school[contact][manager]" type="text" class="form-control" id="manager" placeholder="Owner/Manager Name">  
                        </div>
                    </div>
                    <div class="row mb-2">
                        <h5>Are you the Owner/Manager</h5>
                        <div class="">
                            <input class="btn-check owner" type="radio" name="school[owner]" value="true" id="owner-true">
                            <label class="btn btn-outline-secondary" for="owner-true">Yes, I am</label>
                            <input class="btn-check owner" type="radio" name="school[owner]" value="false" id="owner-false">
                            <label class="btn btn-outline-secondary" for="owner-false">No, I'm not</label>
                        </div>
                    </div>
                    <div class="alert alert-primary owner-alert hide" role="alert">
                        <i class="fa-solid fa-circle-exclamation"></i> You'll be asked to send <span data-bs-toggle="modal" data-bs-target="#proof-modal" role="button"><strong>proof of business</strong></span> before verifying ownership. 
                    </div>
                </div>

                <div class="mb-3 text-end">
                    <button type="button" class="btn btn-primary next-step">Continue</button>
                </div>
            </div>
            <!-- Card 1 - End -->

            <!-- Card 2 - Start -->
            <div data-card="2" class="hidden">
                <div class="row mb-3">
                    <div>
                        <label for="description" class="form-label">Brief Description</label>
                        <textarea name="school[description]" type="text" class="form-control" id="description" row="3" placeholder="e.g. English friendly preschool with own playground in the quiet neighborhood of Prague"></textarea>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="price" class="form-label">Tuition Fees <strong>a month</strong></label>
                    <div class="input-group">
                        <input name="school[price][value]" type="number" min="0" step="0.10" class="form-control" id="price" placeholder="e.g. 6.98">  
                        <select name="school[price][currency]" id="currencyList" class="form-select">
                            <option value="USD" selected="selected" label="US dollar">USD</option>
                            <option value="EUR" label="Euro">EUR</option>
                            <option value="JPY" label="Japanese yen">JPY</option>
                            <option value="GBP" label="Pound sterling">GBP</option>
                            <option disabled>──────────</option>
                            <!-- <option value="AED" label="United Arab Emirates dirham">AED</option>
                            <option value="AFN" label="Afghan afghani">AFN</option>
                            <option value="ALL" label="Albanian lek">ALL</option>
                            <option value="AMD" label="Armenian dram">AMD</option>
                            <option value="ANG" label="Netherlands Antillean guilder">ANG</option>
                            <option value="AOA" label="Angolan kwanza">AOA</option> -->
                            <!-- <option value="ARS" label="Argentine peso">ARS</option> -->
                            <option value="AUD" label="Australian dollar">AUD</option>
                            <!-- <option value="AWG" label="Aruban florin">AWG</option>
                            <option value="AZN" label="Azerbaijani manat">AZN</option> -->
                            <!-- <option value="BAM" label="Bosnia and Herzegovina convertible mark">BAM</option> -->
                            <!-- <option value="BBD" label="Barbadian dollar">BBD</option> -->
                            <!-- <option value="BDT" label="Bangladeshi taka">BDT</option>
                            <option value="BGN" label="Bulgarian lev">BGN</option>
                            <option value="BHD" label="Bahraini dinar">BHD</option> -->
                            <!-- <option value="BIF" label="Burundian franc">BIF</option> -->
                            <!-- <option value="BMD" label="Bermudian dollar">BMD</option> -->
                            <!-- <option value="BND" label="Brunei dollar">BND</option> -->
                            <!-- <option value="BOB" label="Bolivian boliviano">BOB</option> -->
                            <!-- <option value="BRL" label="Brazilian real">BRL</option>
                            <option value="BSD" label="Bahamian dollar">BSD</option>
                            <option value="BTN" label="Bhutanese ngultrum">BTN</option>
                            <option value="BWP" label="Botswana pula">BWP</option>
                            <option value="BYN" label="Belarusian ruble">BYN</option>
                            <option value="BZD" label="Belize dollar">BZD</option> -->
                            <option value="CAD" label="Canadian dollar">CAD</option>
                            <!-- <option value="CDF" label="Congolese franc">CDF</option> -->
                            <option value="CHF" label="Swiss franc">CHF</option>
                            <!-- <option value="CLP" label="Chilean peso">CLP</option> -->
                            <option value="CNY" label="Chinese yuan">CNY</option>
                            <!-- <option value="COP" label="Colombian peso">COP</option> -->
                            <!-- <option value="CRC" label="Costa Rican colón">CRC</option> -->
                            <!-- <option value="CUC" label="Cuban convertible peso">CUC</option> -->
                            <!-- <option value="CUP" label="Cuban peso">CUP</option> -->
                            <!-- <option value="CVE" label="Cape Verdean escudo">CVE</option> -->
                            <option value="CZK" label="Czech koruna">CZK</option>
                            <!-- <option value="DJF" label="Djiboutian franc">DJF</option> -->
                            <option value="DKK" label="Danish krone">DKK</option>
                            <!-- <option value="DOP" label="Dominican peso">DOP</option> -->
                            <!-- <option value="DZD" label="Algerian dinar">DZD</option> -->
                            <!-- <option value="EGP" label="Egyptian pound">EGP</option> -->
                            <!-- <option value="ERN" label="Eritrean nakfa">ERN</option> -->
                            <!-- <option value="ETB" label="Ethiopian birr">ETB</option> -->
                            <!-- <option value="EUR" label="EURO">EUR</option> -->
                            <!-- <option value="FJD" label="Fijian dollar">FJD</option> -->
                            <!-- <option value="FKP" label="Falkland Islands pound">FKP</option> -->
                            <option value="GBP" label="British pound">GBP</option>
                            <!-- <option value="GEL" label="Georgian lari">GEL</option> -->
                            <!-- <option value="GGP" label="Guernsey pound">GGP</option> -->
                            <!-- <option value="GHS" label="Ghanaian cedi">GHS</option> -->
                            <!-- <option value="GIP" label="Gibraltar pound">GIP</option> -->
                            <!-- <option value="GMD" label="Gambian dalasi">GMD</option> -->
                            <!-- <option value="GNF" label="Guinean franc">GNF</option>
                            <option value="GTQ" label="Guatemalan quetzal">GTQ</option>
                            <option value="GYD" label="Guyanese dollar">GYD</option> -->
                            <option value="HKD" label="Hong Kong dollar">HKD</option>
                            <!-- <option value="HNL" label="Honduran lempira">HNL</option> -->
                            <!-- <option value="HRK" label="Croatian kuna">HRK</option> -->
                            <!-- <option value="HTG" label="Haitian gourde">HTG</option>
                            <option value="HUF" label="Hungarian forint">HUF</option> -->
                            <!-- <option value="IDR" label="Indonesian rupiah">IDR</option> -->
                            <option value="ILS" label="Israeli new shekel">ILS</option>
                            <!-- <option value="IMP" label="Manx pound">IMP</option>
                            <option value="INR" label="Indian rupee">INR</option>
                            <option value="IQD" label="Iraqi dinar">IQD</option>
                            <option value="IRR" label="Iranian rial">IRR</option> -->
                            <option value="ISK" label="Icelandic króna">ISK</option>
                            <!-- <option value="JEP" label="Jersey pound">JEP</option>
                            <option value="JMD" label="Jamaican dollar">JMD</option>
                            <option value="JOD" label="Jordanian dinar">JOD</option> -->
                            <option value="JPY" label="Japanese yen">JPY</option>
                            <!-- <option value="KES" label="Kenyan shilling">KES</option>
                            <option value="KGS" label="Kyrgyzstani som">KGS</option>
                            <option value="KHR" label="Cambodian riel">KHR</option>
                            <option value="KID" label="Kiribati dollar">KID</option>
                            <option value="KMF" label="Comorian franc">KMF</option>
                            <option value="KPW" label="North Korean won">KPW</option> -->
                            <option value="KRW" label="South Korean won">KRW</option>
                            <!-- <option value="KWD" label="Kuwaiti dinar">KWD</option>
                            <option value="KYD" label="Cayman Islands dollar">KYD</option>
                            <option value="KZT" label="Kazakhstani tenge">KZT</option>
                            <option value="LAK" label="Lao kip">LAK</option>
                            <option value="LBP" label="Lebanese pound">LBP</option>
                            <option value="LKR" label="Sri Lankan rupee">LKR</option>
                            <option value="LRD" label="Liberian dollar">LRD</option>
                            <option value="LSL" label="Lesotho loti">LSL</option>
                            <option value="LYD" label="Libyan dinar">LYD</option>
                            <option value="MAD" label="Moroccan dirham">MAD</option>
                            <option value="MDL" label="Moldovan leu">MDL</option>
                            <option value="MGA" label="Malagasy ariary">MGA</option>
                            <option value="MKD" label="Macedonian denar">MKD</option>
                            <option value="MMK" label="Burmese kyat">MMK</option>
                            <option value="MNT" label="Mongolian tögrög">MNT</option>
                            <option value="MOP" label="Macanese pataca">MOP</option>
                            <option value="MRU" label="Mauritanian ouguiya">MRU</option>
                            <option value="MUR" label="Mauritian rupee">MUR</option>
                            <option value="MVR" label="Maldivian rufiyaa">MVR</option>
                            <option value="MWK" label="Malawian kwacha">MWK</option>
                            <option value="MXN" label="Mexican peso">MXN</option> -->
                            <option value="MYR" label="Malaysian ringgit">MYR</option>
                            <!-- <option value="MZN" label="Mozambican metical">MZN</option>
                            <option value="NAD" label="Namibian dollar">NAD</option>
                            <option value="NGN" label="Nigerian naira">NGN</option>
                            <option value="NIO" label="Nicaraguan córdoba">NIO</option>
                            <option value="NOK" label="Norwegian krone">NOK</option>
                            <option value="NPR" label="Nepalese rupee">NPR</option> -->
                            <option value="NZD" label="New Zealand dollar">NZD</option>
                            <!-- <option value="OMR" label="Omani rial">OMR</option>
                            <option value="PAB" label="Panamanian balboa">PAB</option>
                            <option value="PEN" label="Peruvian sol">PEN</option>
                            <option value="PGK" label="Papua New Guinean kina">PGK</option>
                            <option value="PHP" label="Philippine peso">PHP</option>
                            <option value="PKR" label="Pakistani rupee">PKR</option> -->
                            <option value="PLN" label="Polish złoty">PLN</option>
                            <!-- <option value="PRB" label="Transnistrian ruble">PRB</option>
                            <option value="PYG" label="Paraguayan guaraní">PYG</option> -->
                            <option value="QAR" label="Qatari riyal">QAR</option>
                            <!-- <option value="RON" label="Romanian leu">RON</option>
                            <option value="RSD" label="Serbian dinar">RSD</option>
                            <option value="RUB" label="Russian ruble">RUB</option>
                            <option value="RWF" label="Rwandan franc">RWF</option>
                            <option value="SAR" label="Saudi riyal">SAR</option> -->
                            <option value="SEK" label="Swedish krona">SEK</option>
                            <option value="SGD" label="Singapore dollar">SGD</option>
                            <!-- <option value="SHP" label="Saint Helena pound">SHP</option>
                            <option value="SLL" label="Sierra Leonean leone">SLL</option>
                            <option value="SLS" label="Somaliland shilling">SLS</option>
                            <option value="SOS" label="Somali shilling">SOS</option>
                            <option value="SRD" label="Surinamese dollar">SRD</option>
                            <option value="SSP" label="South Sudanese pound">SSP</option>
                            <option value="STN" label="São Tomé and Príncipe dobra">STN</option>
                            <option value="SYP" label="Syrian pound">SYP</option>
                            <option value="SZL" label="Swazi lilangeni">SZL</option>
                            <option value="THB" label="Thai baht">THB</option>
                            <option value="TJS" label="Tajikistani somoni">TJS</option>
                            <option value="TMT" label="Turkmenistan manat">TMT</option>
                            <option value="TND" label="Tunisian dinar">TND</option>
                            <option value="TOP" label="Tongan paʻanga">TOP</option>
                            <option value="TRY" label="Turkish lira">TRY</option>
                            <option value="TTD" label="Trinidad and Tobago dollar">TTD</option>
                            <option value="TVD" label="Tuvaluan dollar">TVD</option> -->
                            <option value="TWD" label="New Taiwan dollar">TWD</option>
                            <!-- <option value="TZS" label="Tanzanian shilling">TZS</option>
                            <option value="UAH" label="Ukrainian hryvnia">UAH</option>
                            <option value="UGX" label="Ugandan shilling">UGX</option> -->
                            <!-- <option value="USD" label="United States dollar">USD</option> -->
                            <!-- <option value="UYU" label="Uruguayan peso">UYU</option>
                            <option value="UZS" label="Uzbekistani soʻm">UZS</option>
                            <option value="VES" label="Venezuelan bolívar soberano">VES</option> -->
                            <!-- <option value="VND" label="Vietnamese đồng">VND</option> -->
                            <!-- <option value="VUV" label="Vanuatu vatu">VUV</option>
                            <option value="WST" label="Samoan tālā">WST</option>
                            <option value="XAF" label="Central African CFA franc">XAF</option>
                            <option value="XCD" label="Eastern Caribbean dollar">XCD</option>
                            <option value="XOF" label="West African CFA franc">XOF</option>
                            <option value="XPF" label="CFP franc">XPF</option>
                            <option value="ZAR" label="South African rand">ZAR</option>
                            <option value="ZMW" label="Zambian kwacha">ZMW</option>
                            <option value="ZWB" label="Zimbabwean bonds">ZWB</option> -->
                        </select>
                    </div>
                    <small class="pt-1">Select your <strong>local currency</strong> or currency that is mainly used in your area</small>
                </div>
                
                <div class="pt-2 mb-3">
                    <h5>Amenities & Features</h5>
                    <div>
                        <% for (const amenity of amenities) { %> 
                            <input type="checkbox" class="btn-check" name="school[amenities]" value="<%= amenity.name %>" id="<%= amenity.name %>" autocomplete="off">
                            <label class="btn btn-outline-secondary mt-1" for="<%= amenity.name %>"><%= amenity.name %></label> 
                            <% } %>
                    </div>
                </div>

                <div class="pt-2 mb-3">
                    <h5>Cover image</h5>
                    <div class="col-6">
                        <div class="input-group mb-3">
                            <input type="file" name="image" class="form-control" id="inputGroupFile02">
                            <!-- <label class="input-group-text" for="inputGroupFile02">Upload</label> -->
                        </div>
                    </div>
                </div>
                    
                <!-- Submit button -->
                <div class="mb-3 text-end">
                    <button type="submit" class="btn btn-primary">Submit</button>
                </div>
                
            </div>
            <!-- Card 2 - End -->

            <!-- 
            <div class="d-grid mb-3">
                <button type="submit" class="btn btn-primary">Submit</button>
            </div> -->
        </form>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="proof-modal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header border-bottom-0">
            <button type="button" class="btn-close float-end pt-4 pe-1" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <div class="text-center">
                <h3><i class="fa-solid fa-briefcase"></i></h3>
                <h5 class="mb-3">Proof of Business</h5>
                <p class="mb-3">To avoid imposters and fake accounts, we'll need to verify that you are the owner or manager of the listed school. <br>
                    You can verify the ownership by sending us an utility bill, a rental agreement or an employment agreement later from your dashboard.</p>
            </div>
        </div>
      </div>
    </div>
  </div>

<!-- Google Maps init -->
<!-- <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDcyfjKf470fXkIpckMkfumveGOU2X7Ao8&callback=initMap"></script>
<script src="/js/googleMaps.js"></script> -->

<!-- <script src="/js/form.js"></script> -->

<script>
    const geocoderCityContainer = document.getElementById('geocoder-city');
    const geocoderAddressContainer = document.getElementById('geocoder-address');
    mapboxgl.accessToken = '<%- process.env.MAPBOX_TOKEN %>'

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11', // style URL
        center: [-20, 45], // starting position [lng, lat]
        zoom: 1 // starting zoom
    });

    // create geocoder
    const geocoderCity = new MapboxGeocoder({
        accessToken: mapboxgl.accessToken
    })

    const geocoderStreet = new MapboxGeocoder({ 
        accessToken: mapboxgl.accessToken,
    });
    

    const marker = new mapboxgl.Marker();

    geocoderCity.addTo('#geocoder-city');
    geocoderStreet.addTo('#geocoder-address');

    // Input mockup
    const mockupInputCity = document.querySelector('#geocoder-city .mapboxgl-ctrl-geocoder--input');
    mockupInputCity.disabled = true;
    mockupInputCity.parentElement.style.width = '100%';
    mockupInputCity.style.maxWidth = '100%';
    mockupInputCity.parentElement.style.opacity = '50%';

    function mockupAddress() {
        const mockupInputAddress = document.querySelector('#geocoder-address .mapboxgl-ctrl-geocoder--input');
        mockupInputAddress.disabled = true;
        mockupInputAddress.parentElement.style.width = '100%';
        mockupInputAddress.parentElement.style.maxWidth = '100%';
        mockupInputAddress.parentElement.style.opacity = '50%';
    }
    mockupAddress()


    // GEOCODER - create real search bar AFTER country is selected
    const countryInput = document.querySelector('#country');
    const optGroups = document.querySelectorAll('optgroup');
    
    countryInput.addEventListener('change', (e) => {
        // remove previous geocoder search bar if there's any
        if (geocoderCityContainer.firstChild != null) {
            geocoderCityContainer.innerHTML = '';
        }

        // Select continent and update field
        for (const group of optGroups) {
            for (const option of group.children) {
                if (option.value === e.target.value) {
                    const continent = document.querySelector('#_continent');
                    continent.value = group.label;
                }
            }
        }

        // create geocoder for CITY
        const geocoderCity = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            countries: e.target.value,
            types: 'place',
            // mapboxgl: mapboxgl
        })

        // Attach Geocoder to my html element 
        // geocoderCityContainer.appendChild(geocoderCity.onAdd());
        geocoderCity.addTo('#geocoder-city');

        // CITY GEOCODER CUSTOM CSS
        const geocoderAddon = geocoderCityContainer.firstChild;
        geocoderAddon.style.width = '100%';
        geocoderAddon.style.maxWidth = '100%';

        geocoderCity.on('result', (e) => {
            console.log(e.result)

            // get the bounding box of the selected city
            let bbox = e.result.bbox;

            // City - update hidden field
            document.querySelector('#_city').value = e.result.text;
            
            // add bbox to hidden field to save to database for future use
            // convert to string first so it can be added into input
            document.querySelector('#_bbox').value = bbox.join();
            console.log(document.getElementById('_bbox').value)

            // Update input with City center coordinates
            document.querySelector('#_cityCenterCoords').value = e.result.center;

            // remove previous geocoder search bar if there's any
            if (geocoderAddressContainer.firstChild != null) {
                geocoderAddressContainer.innerHTML = '';
            }

            const geocoderAddress = new MapboxGeocoder({
                accessToken: mapboxgl.accessToken,
                bbox: bbox,
                types: 'address',
                mapboxgl: mapboxgl
            })

            geocoderAddress.addTo('#geocoder-address');

            // ADDRESS GEOCODER CUSTOM CSS
            const geocoderAddonAddress = geocoderAddressContainer.firstChild;
            geocoderAddonAddress.style.width = '100%';
            geocoderAddonAddress.style.maxWidth = '100%';
            
            // ADDRESS geocoder -- START
            geocoderAddress.on('result', (e) => {
                console.log(e.result)
    
                marker.setLngLat(e.result.geometry.coordinates).addTo(map)
    
                document.querySelector('#_coordinates').value = e.result.geometry.coordinates;
    
                document.querySelector('#_lat').value = e.result.geometry.coordinates[0];
                document.querySelector('#_long').value = e.result.geometry.coordinates[1];
    
                // Full Address, Street Name & Number
                document.querySelector('#_fullAddress').value = e.result.place_name; 
                document.querySelector('#_streetName').value = e.result.text;
                document.querySelector('#_streetNumber').value = e.result.address;
    
                for (const result of e.result.context) {
                    // // City
                    // if (result.id.match("place")) {
                    //     document.querySelector('#_city').value = result.text;
                    // }
    
                    // Country
                    if (result.id.match("country")) {
                        document.querySelector('#_countryName').value = result.text;
                    }
    
                    // Postcode
                    if (result.id.match("postcode")) {
                        document.querySelector('#_zip').value = result.text;
                    }
    
                    // State / Province e.g.Maine
                    if (result.id.match("region")) {
                        document.querySelector('#_region').value = result.text;
                    }
    
                    // County e.g.Washington County
                    if (result.id.match("district")) {
                        document.querySelector('#_district').value = result.text;
                    }
    
                    // Borough e.g.Brooklyn
                    if (result.id.match("locality")) {
                        document.querySelector('#_locality').value = result.text;
                    }
    
                    // Borough e.g.Venice Beach
                    if (result.id.match("neighborhood")) {
                        document.querySelector('#_neighborhood').value = result.text;
                    }
                }

                map.flyTo({
                    center: e.result.center,
                    zoom: 16
                })
                // ADDRESS geocoder -- END
            });
        })
    
    
        // Clear address bar and add back mockup on CITY clear
        geocoderCity.on('clear', () => {
            const inp = document.querySelector('#geocoder-address');
            inp.innerHTML = '';
            geocoderStreet.addTo('#geocoder-address');
            mockupAddress()
        });

    })
</script>

<script>
    // FORM STEPS & VALIDATION
    const form = document.querySelector('form');
    const nextBtn = document.querySelector('.next-step');
    const backBtn = document.querySelector('.back-button');
    const card1 = document.querySelector("[data-card='1']");
    const card2 = document.querySelector("[data-card='2']");
    const step1 = document.querySelector('#step-1');
    const step2 = document.querySelector('#step-2');

    const checkBoxes = document.querySelectorAll('input[type=checkbox]');
    const catInvalidFeedback = document.querySelector('#cat-invalid-feedback');
    const catValidFeedback = document.querySelector('#cat-valid-feedback');

    let stepCounter = 1;

    nextBtn.addEventListener('click', () => {
        const currentCard = document.querySelector(`[data-card="${stepCounter}"]`);
        const inputs = currentCard.querySelectorAll('input, select, textarea');
        console.log(currentCard)

        for (const inp of inputs) {
            if (!inp.checkValidity()) {
                inp.classList.add('is-invalid');
                inp.addEventListener('change', function(e) {
                    // check on fly if required inputs are being updated
                    if (e.target.checkValidity()) {
                        e.target.classList.remove('is-invalid');
                        e.target.classList.add('is-valid');
                    } else {
                        e.target.classList.remove('is-valid');
                        e.target.classList.add('is-invalid');
                    }
                })
            } else {
                inp.classList.remove('is-invalid')
                inp.classList.add('is-valid')
            }
        }

        const checked = document.querySelectorAll('input[type=checkbox]:checked').length;

        if (!checked) {
            catInvalidFeedback.style.display = 'block';
            catValidFeedback.style.display = 'none'
            // alert('you must check at least one')
            return false;
        }

        // check for any invalid classes on page
        // if none found, add +1 to stepCounter and switch the card
        if (!document.querySelector('.is-invalid')) {
            stepCounter ++;
            card1.classList.add('hidden')
            card2.classList.remove('hidden');
            backBtn.classList.remove('hidden');
            step1.classList.remove('active');
            step2.classList.add('active');
        }
    });

    checkBoxes.forEach(el => {
            el.addEventListener('change', () => {
                const checked = document.querySelectorAll('input[type=checkbox]:checked').length;

                if (!checked) {
                    catInvalidFeedback.style.display = 'block';
                    catValidFeedback.style.display = 'none'
                } else {
                    catInvalidFeedback.style.display = 'none'
                    catValidFeedback.style.display = 'block'
                }


            })
    })


    backBtn.addEventListener('click', () => {
        card1.classList.remove('hidden');
        card2.classList.add('hidden');
        backBtn.classList.add('hidden');
        step1.classList.add('active');
        step2.classList.remove('active');
    })
</script>        


<script>
    // Onwer alert box
    const radios = document.querySelectorAll('input[type=radio].owner');
    const ownerAlertBox = document.querySelector('.owner-alert');

    radios.forEach(el => {
        el.addEventListener('change', (e) => {
            console.log(e.target.value)

            if (e.target.value === 'true') {
                ownerAlertBox.classList.remove('hide');
            } 
            
            if (e.target.value === 'false') {
                ownerAlertBox.classList.add('hide');
            } 
        })
    })
</script>

<script>
    document.querySelector('form').addEventListener('submit', () => {
        showSpinner();
    })
</script>
   
